{% extends "base.html" %}

{% block title %}SAP Service Order Automation - Wizard{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow-sm">
            <div class="card-header bg-dark text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h2 class="h5 mb-0">{{ step_data.title }}</h2>
                    <span class="badge bg-primary">Step {{ current_step }} of {{ total_steps }}</span>
                </div>
            </div>
            <div class="card-body">
                <div class="progress mb-4">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" 
                         style="width: {{ (current_step / total_steps) * 100 }}%" 
                         aria-valuenow="{{ current_step }}" aria-valuemin="0" aria-valuemax="{{ total_steps }}"></div>
                </div>
                
                <h3 class="h6">Service Order: <span class="text-info">{{ service_order }}</span></h3>
                
                {% if 'pn' in step_data %}
                <div class="alert alert-info">
                    <strong>Part Number:</strong> {{ step_data.pn }}
                </div>
                {% endif %}
                
                {% if 'sn' in step_data %}
                <div class="alert alert-info">
                    <strong>Serial Number:</strong> {{ step_data.sn }}
                </div>
                {% endif %}
                
                <p class="card-text mt-3">{{ step_data.question }}</p>
                
                {% if 'error' in step_data %}
                <div class="alert alert-danger">
                    {{ step_data.error }}
                </div>
                {% endif %}
                
                <form action="{{ url_for('process_step') }}" method="post" class="mt-4">
                    <input type="hidden" name="service_order" value="{{ service_order }}">
                    <input type="hidden" name="current_step" value="{{ current_step }}">
                    
                    {% if retry %}
                    <input type="hidden" name="retry" value="true">
                    {% endif %}
                    
                    {% if 'input_type' in step_data %}
                        <div class="mb-3">
                            <input type="text" class="form-control" id="manual_input" name="manual_input" required 
                                   placeholder="Enter {{ step_data.input_type.replace('_', ' ') }}">
                        </div>
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">Verify</button>
                        </div>
                    {% else %}
                        <div class="d-grid gap-2">
                            <button type="submit" name="response" value="yes" class="btn btn-success">Yes</button>
                            <button type="submit" name="response" value="no" class="btn btn-danger">No</button>
                        </div>
                    {% endif %}
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}